---
import type { GetStaticPaths } from "astro";
import { getCollection, getEntry, render, type CollectionEntry  } from 'astro:content';
import { languages } from "../../../i18n/ui";
import Layout from "../../../layouts/Layout.astro";
import ServicesHeader from "../../../components/headers/servicesHeader.astro";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";
// 1. Generate a new path for every collection entry

export const getStaticPaths = (async() => {
    const locales = Object.keys(languages);
    const services = await getCollection("services");
    const allpages = []

    for (const locale of locales) {
        for (const service of services) {
            allpages.push({
                params: { locale, id: service.data.title },
                props: {service}
            })
        }
    }
    return allpages;
}) satisfies GetStaticPaths;

interface Props {
    service: CollectionEntry<"services">
}

// 2. For your template, you can get the entry directly from the prop
const { service } = Astro.props;
const { Content, remarkPluginFrontmatter, headings } = await render(service);

const locale = getLangFromUrl(Astro.url);
const t = useTranslations(locale);
const expert = await getEntry(service.data.author);
---

<Layout title={service.data.title} desc={service.data.description}>


    <ServicesHeader hText={service.data.description} currentPage={service.data.title} />

    <div class="container mx-auto nav flex-column flex-lg-row py-5 px-3 position-relative">

        <nav class="col-lg-4 order-0 order-lg-2">

            <div class="sticky-top">
                <h4>{t('t.content')}</h4>
                <ul class="border-start border-3 border-primary mb-3">
                    
                    {headings.map( head => <li class={head.depth > 2 ? `ms-${head.depth-1}` : ``}>
                        <a href={`#${head.slug}`}>{head.text} </a>
                    </li>)}
                </ul>
            </div>

        </nav>

        <main id="content" class="col-lg-8">
            <p>Expert : {expert.data.name}, {expert.data.role} <span class="vr mx-3" /> {remarkPluginFrontmatter.minutesRead} </p>
            <Content /> 
        </main>
        
        <section class="col-9 order-4 pt-3">
            <a data-iobs="right" href={`/nbc/${service.id.slice(0,2)}/services`} class="btn btn-outline-primary">
                <i class="bi bi-arrow-left"></i> services
            </a>
        </section>
                
    </div>

</Layout>

<style>
    h1, h2, h3 {
        color: var(--bs-primary);
    }

    #content blockquote p {
        padding: 1rem !important;
        border-left: 1rem solid $primary ;
    }
</style>